% !TeX spellcheck = es_ES
% !TeX root = main.tex

\chapter{Diseño}
Una vez planteados los requerimientos y especificaciones iniciales de la migración de Ksensor, realizado el estudio de alternativas de los puntos más críticos del diseño y elegidas las alternativas óptimas en cada caso, en este capítulo se describirá de forma breve el diseño general de la solución propuesta en el presente proyecto.

Tanto como no se han decidido cambios propiamente en el diseño del sensor, habrán de adaptarse la estructura del código para su integración propuesta, así como migrar a una rama de desarrollo paralela al kernel de Linux.

No obstante, aunque no se haya cambiado el diseño de alto nivel del proyecto anterior, se harán cambios estructurales de bajo nivel. A continuación, se describirán los nuevos elementos que compondrán el sistema.

\section{Módulo de estadísticas}
El módulo de estadísticas, es uno diferente al mencionado en el proyecto ksensor \cite{KABO05}. Tanto como ese es de estadísticas internas de Ksensor, este trata de sacar a la luz otras mediciones que son útiles a la hora de diagnosticar la efectividad del sistema de captura. En este apartado se explicarán primeramente las características principales de este módulo y después se pasará a explicar el funcionamiento general del mismo.

Durante su funcionamiento, llevará la cuenta de varios datos que son interesantes para el diagnóstico del sistema, como la cantidad de veces que se han recogido paquetes, el número de interrupciones de la tarjeta y otros datos que permiten hacer mediciones de como de efectiva es la captura.

Es importante remarcar que estos datos son los necesarios para hacer diagnósticos de la efectividad del módulo de captura. Recoger estadísticas que son propias del kernel persé es algo que no se ha tenido en cuenta hasta ahora. Es algo necesario para poder medir la efectividad de la sonda.

Está constituido por dos partes: las modificaciones en el kernel para hacer posible la creación y medición de dichas estadísticas; y el módulo que proporciona el acceso a las mismas.

El usuario del módulo, deberá activar una opción en la compilación del kernel, y podrá insertarlo para observar las mediciones que se hagan a través de unos ficheros virtuales específicamente creados para tal fin.

\section{Módulo de traceo}
Este módulo ha sido creado específicamente para la monitorización de la distribución de tiempos de captura. Ha sido creado porque tras haber analizado las estadísticas que proveía la anterior implementación de Ksensor, se han visto defectos que hacen pensar que el sistema actual no es todo lo eficiente que puede ser.

Para ello, el módulo estará también dividido en dos partes, como en el otro caso, la primera son las modificaciones que habrá que hacer para hacer las mediciones y guardar los tiempos de cada traza, y la segunda será el módulo que inicializará la función para salvar las trazas.

De esta manera, el usuario puede elegir cuando se emplea tiempo en guardar las trazas y cuando no. Además, tendrá acotado en todo momento el tiempo en el que se hacen las trazas.

Este diseño permite al usuario cargar y descargar el módulo, utilizando diferentes funciones que hagan cosas totalmente diferentes de las establecidas si se quiere, sin necesidad de recompilar el módulo.

A parte de la característica de dejar que el módulo haga lo que considere con los datos, el módulo diseñado en un primer lugar, crea un fichero virtual para acceder a los datos en modo de lista, permitiendo de esa manera que el usuario pueda acceder a todos los datos en orden.